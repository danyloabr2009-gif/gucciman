from telethon import TelegramClient, events
import asyncio

# ================= –ù–ê–°–¢–†–û–ô–ö–ò =================
# –í—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ —Å —Å–∞–π—Ç–∞ (—á–∏—Ñ—Ä—ã –±–µ–∑ –∫–∞–≤—ã—á–µ–∫, —Ö–µ—à –≤ –∫–∞–≤—ã—á–∫–∞—Ö):
api_id = 38562987           
api_hash = 'a638356724cb39be09d9e245c431d0a4'

# –Æ–∑–µ—Ä–Ω–µ–π–º –∫–∞–Ω–∞–ª–∞, –≥–¥–µ –ª–æ–≤–∏–º —á–µ–∫–∏ (–±–µ–∑ @).
# –î–ª—è —Ç–µ—Å—Ç–∞ –º–æ–∂–µ—à—å –ø–µ—Ä–µ—Å–ª–∞—Ç—å —á–µ–∫ –≤ "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ" –∏ –Ω–∞–ø–∏—Å–∞—Ç—å —Ç—É—Ç 'me'
target_channel = 'cisnewstg' 
# =============================================

client = TelegramClient('anon_session', api_id, api_hash)

print("‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω! –û–∂–∏–¥–∞–Ω–∏–µ —á–µ–∫–æ–≤...")

@client.on(events.NewMessage(chats=target_channel))
async def handler(event):
    if not event.buttons:
        return

    for row in event.buttons:
        for btn in row:
            # –ò—â–µ–º –∫–Ω–æ–ø–∫—É, –≥–¥–µ –µ—Å—Ç—å —Å–ª–æ–≤–æ "–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å" (–∏–ª–∏ activate)
            if "–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å" in btn.text.lower() or "activate" in btn.text.lower():
                print(f"\n[!!!] –í–∏–∂—É —á–µ–∫! –ö–Ω–æ–ø–∫–∞: {btn.text}")
                
                # –°–ø–æ—Å–æ–± 1: –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ ‚Äî —ç—Ç–æ —Å—Å—ã–ª–∫–∞ (–∫–∞–∫ –Ω–∞ —Ç–≤–æ–µ–º —Å–∫—Ä–∏–Ω–µ —Å–æ —Å—Ç—Ä–µ–ª–∫–æ–π)
                if hasattr(btn, 'url') and btn.url:
                    url = btn.url
                    print(f"üîó –°—Å—ã–ª–∫–∞: {url}")
                    
                    if '?start=' in url:
                        try:
                            # –î–æ—Å—Ç–∞–µ–º –∫–æ–¥ –∏–∑ —Å—Å—ã–ª–∫–∏
                            bot_username = url.split('?start=')[0].split('/')[-1]
                            code = url.split('?start=')[1]
                            
                            print(f"ü§ñ –ë–æ—Ç: {bot_username} | –ö–æ–¥: {code}")
                            print("üöÄ –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å...")
                            
                            await client.send_message(bot_username, f'/start {code}')
                            print("‚úÖ –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—è–π –∫–æ—à–µ–ª–µ–∫.")
                        except Exception as e:
                            print(f"‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Å—ã–ª–∫–∏: {e}")
                
                # –°–ø–æ—Å–æ–± 2: –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –æ–±—ã—á–Ω–∞—è (callback)
                else:
                    try:
                        await btn.click()
                        print("‚úÖ –ù–∞–∂–∞–ª –Ω–∞ –∫–Ω–æ–ø–∫—É!")
                    except Exception as e:
                        print(f"‚ùå –û—à–∏–±–∫–∞ –Ω–∞–∂–∞—Ç–∏—è: {e}")

client.start()
client.run_until_disconnected()